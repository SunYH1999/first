<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style type="text/css">
		* {
			margin: 0;
			padding: 0;
		}
		canvas {
			display: block;
			border: 1px solid red;
			margin: 0 auto;
		}
	</style>
</head>
<body>
	<canvas id="myCanvas" width="360" height="512"></canvas>
	<script type="text/javascript" src="js/Background.js"></script>
	<script type="text/javascript" src="js/Bird.js"></script>
	<script type="text/javascript" src="js/Game.js"></script>
	<script type="text/javascript" src="js/Pipe.js"></script>
	<script type="text/javascript">
	/*
		游戏分析：
			像素鸟游戏就是一只鸟在不停的穿越管子
			同时，管子， 背景（山， 地面）向后撤， 远处的山移动速度比较慢
		当前游戏需要几个类：
			鸟类， 管子类， 背景类（山，地面），游戏类

		继续分析：
			当前游戏需要很多图片
			所需的图片有: ["images/bird0_0.png", "images/bird0_1.png", "images/bird0_2.png", "images/bg_day.png", "images/land.png", "images/pipe_down.png", "images/pipe_up.png"]
	 */

	 // 定义数组用于存放所有图片
	 var imgArr = ["images/bird0_0.png", "images/bird0_1.png", "images/bird0_2.png", "images/bg_day.png", "images/land.png", "images/pipe_down.png", "images/pipe_up.png"]
	 
	// 所有图片加载完毕之后执行代码
	loadImage(imgArr, function(imgArr) {console.log(123);
		// 获取canvas元素
		var canvas = document.getElementById("myCanvas");
		// 获取画笔
		var ctx = canvas.getContext("2d");
		// 初始化bird
		var bird = new Bird(imgArr.slice(0, 3), 100, 100);
		// 初始化pipe
		var pipe = new Pipe(imgArr[5], imgArr[6], 4, 360);
		// 初始化land
		var land = new Background(imgArr[4], 4, 0, 400);
		// 初始化mountain
		var mountain = new Background(imgArr[3], 2, 0, 0);

		// 开始游戏
		window.g = new Game(ctx, bird, pipe, land, mountain);

	})


	 // 定义一个函数，传递两个参数， 第一个参数是一个数组，数组中存放的是每一张图片的路径， 第二个参数是一个回调函数，当所有图片加载完毕之后，执行回调函数
	 
	 /**
	 * loadImage 用于加载图片 ，并且当所有图片加载完毕之后 执行回调函数
	 * @arr 数组图片
	 * @callback 回调函数
	 **/
	function loadImage(arr, callback) {
	 	// 定义信号量
	 	var idx = 0;
	 	// 定义一个空数组 用于存放加载后的图片
	 	var loadImageArr = [];
	 	arr.forEach(function(value, index) {
	 		// 创建图片元素
	 		 var img = new Image();
	 		 // 设置路径
			 img.src = value;
			 // 添加事件
			 img.onload = function() {
			 	// 信号量++
			 	idx++;
			 	// 将加载后的图片放入数组中
			 	// 因为load时间的加载顺序不一致，所以我们使用索引值来保证加载顺序
			 	loadImageArr[index] = this;
			 	// 判断信号量与数组中的长度是否相等
			 	if (idx === arr.length) {
			 		// 执行回调函数
			 		callback(loadImageArr);
			 	}
			 }
	 	})
	 }
	</script>
</body>
</html>